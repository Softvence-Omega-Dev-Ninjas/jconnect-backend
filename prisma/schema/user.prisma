// /prisma/schema.prisma (FIXED User Model)

model User {
  id                 String                @id @default(cuid())
  full_name          String
  email              String                @unique
  profilePhoto       String?
  phone              String?               @unique
  password           String
  pinCode            Int?
  otp                String?
  googleId           String?               @unique
  emailOtp           Int?
  otpExpiresAt       DateTime?
  isVerified         Boolean               @default(false)
  is_terms_agreed    Boolean               @default(false)
  isLogin            Boolean               @default(false)
  isDeleted          Boolean               @default(false)
  isActive           Boolean               @default(true)
  login_attempts     Int?                  @default(0)
  // OTP sent to phone for phone verification
  phoneOtp           Int?
  phoneOtpExpiresAt  DateTime?
  phoneVerified      Boolean               @default(false)
  last_login_at      DateTime?
  created_at         DateTime              @default(now())
  updated_at         DateTime              @updatedAt
  token_expires_at   DateTime?
  role               Role                  @default(USER)
  validation_type    ValidationType?       @default(EMAIL)
  auth_provider      AuthProvider?
  // Relation to Service Model 
  profile            Profile?
  serviceRequests    ServiceRequest[]
  services           Service[]
  devices            Device[]
  LiveChatsCreated   LiveChat[]            @relation("LiveChatCreator")
  chatParticipations LiveChatParticipant[]
  liveMessages       LiveMessage[]
  liveMessageReads   LiveMessageRead[]

  // Custom Service Requests relations
  customRequestsMade     CustomServiceRequest[] @relation("BuyerCustomRequests")
  customRequestsReceived CustomServiceRequest[] @relation("TargetedCustomRequests")
  reviews                Review[]               @relation("ReviewsGiven")
  reviewsreceive         Review[]               @relation("ReviewsReceived")

  //social request relations
  socialServiceRequests SocialServiceRequest[] @relation("SocialRequestBuyer")
  artistRequester       SocialServiceRequest[] @relation("SocialRequestRequester")

  // socialServices
  socialServices SocialService[]

  @@map("users")
}

model Device {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  browser        String?
  browserVersion String?
  os             String?
  osVersion      String?
  deviceType     String?
  deviceModel    String?
  ipAddress      String?
  lastUsedAt     DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("devices")
}

enum Role {
  USER
  MODERATOR
  ADMIN
  SUPER_ADMIN
  MEMBER
  ARTIST
}

enum ValidationType {
  EMAIL
  PHONE
}

enum AuthProvider {
  GOOGLE
  FACEBOOK
}
